<!-- templates/expenses/home.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    body { padding-bottom: 120px; }
    .form-control { padding: 1.0rem .75rem !important; }
    .card-body { display:flex; align-items:center; justify-content:space-between; }
    .expense-left { display:flex; gap: 1rem; align-items:center; }
    .bottom-form { position: fixed; left: 20px; right: 20px; bottom: 20px; background:transparent; }
    .summary-box { background:#f8f9fa; padding:15px; border-radius:10px; }
    .filter { float:right; }
    .msg { font-weight:500; margin-top:10px; }
    .msg.good { color:#198754; }      /* green */
    .msg.medium { color:#ffc107; }    /* yellow */
    .msg.high { color:#dc3545; }      /* red */
  </style>
</head>
<body>
<div class="container">
  <h3 class="pt-4 text-center">Expense Tracker</h3>


  <!-- Filter dropdown -->
  <form method="get" class="text-end my-2">
    <select name="filter" class="form-select d-inline w-auto" onchange="this.form.submit()">
      <option value="all" {% if filter_option == 'all' %}selected{% endif %}>All Time</option>
      <option value="month" {% if filter_option == 'month' %}selected{% endif %}>This Month</option>
      <option value="year" {% if filter_option == 'year' %}selected{% endif %}>This Year</option>
    </select>
  </form>

  <div class="row mt-3">
    <!-- Left side -->
    <div class="col-md-7" style="height:480px; overflow:auto;">
      <h4>Pending Expenses</h4>
      <p class="text-muted">Total Pending: ‚Çπ{{ pending_total }}</p>
      {% for exp in expenses %}
      <div class="card mb-2">
        <div class="card-body">
          <div class="expense-left">
            <div>
              <strong>{{ exp.title }}</strong><br>
              <small class="text-muted">{{ exp.category }} ‚Ä¢ {{ exp.date }}</small><br>
              <small>{{ exp.description }}</small>
            </div>
            <div>
              <span class="badge bg-secondary">‚Çπ{{ exp.amount }}</span>
            </div>
          </div>
          <div>
            <a href="{% url 'mark_as_cleared' exp.pk %}" class="btn btn-success btn-sm"><i class="fa fa-check"></i> Mark Cleared</a>
            <a href="{% url 'delete_expense' exp.pk %}" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i></a>
            <a href="{% url 'edit_expense' exp.pk %}" class="btn btn-primary btn-sm"><i class="fa fa-pencil"></i></a>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="card"><div class="card-body text-muted">No pending expenses.</div></div>
      {% endfor %}
    </div>

    <!-- Right side -->
    <div class="col-md-5">
      <h5>Cleared Expenses</h5>
      <p class="text-muted">Total Cleared: ‚Çπ{{ cleared_total }}</p>
      {% for exp in cleared_expenses %}
      <div class="card mb-2">
        <div class="card-body">
          <div>
            <strong>{{ exp.title }}</strong><br>
            <small class="text-muted">‚Çπ{{ exp.amount }} ‚Ä¢ {{ exp.category }} ‚Ä¢ {{ exp.date }}</small>
          </div>
          <div>
            <a href="{% url 'mark_as_uncleared' exp.pk %}" class="btn btn-danger btn-sm"><i class="fa fa-times"></i> Mark Undone</a>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="card"><div class="card-body text-muted">No cleared expenses.</div></div>
      {% endfor %}

      <div class="mt-4 summary-box">
        <h6>Summary</h6>
        <p><strong>Total Spent ({{ filter_option|title }}):</strong> ‚Çπ{{ total_spent }}</p>
        <p><strong>Overall Total:</strong> ‚Çπ{{ overall_total }}</p>

        {% if total_spent < 5000 %}
          <p class="msg good">üíö You‚Äôre managing money wisely ‚Äî keep it up!</p>
        {% elif total_spent < 15000 %}
          <p class="msg medium">üíõ Balanced spending ‚Äî nice control!</p>
        {% else %}
          <p class="msg high">‚ù§Ô∏è Spending high! Try saving more next time.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Add expense form fixed at bottom (like your ToDo) -->
  <div class="bottom-form">
    <form action="{% url 'add_expense' %}" method="POST" class="d-flex align-items-center gap-2">
      {% csrf_token %}
      <input type="text" name="title" class="form-control" placeholder="Title (e.g., Groceries)" required>
      <input type="number" step="0.01" name="amount" class="form-control" placeholder="Amount" required style="max-width:140px;">
      <input type="text" name="category" class="form-control" placeholder="Category" style="max-width:160px;">
      <input type="date" name="date" class="form-control" style="max-width:160px;">
      <input type="text" name="description" class="form-control" placeholder="Description (optional)" style="max-width:260px;">
      <button type="submit" class="btn btn-primary" style="width:140px;"><i class="fa fa-plus"></i> Add</button>
    </form>
  </div>
</div>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
